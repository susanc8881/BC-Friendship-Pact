<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Friendship Pact</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .text-maroon-700 { color: #8a100b; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const { motion, AnimatePresence } = window.Motion;

    const QUESTIONS = [
      { q: "What kind of hangouts do you enjoy most?", options: ["Game night", "Coffee chat", "Workout buddy", "Study sesh", "Movie night"] },
      { q: "What's your ideal weekend?", options: ["Exploring Boston", "Relaxing indoors", "Volunteering", "Sports games", "No plans are the best plans"] },
      { q: "How do you prefer to communicate with friends?", options: ["Texting", "Calling", "Inâ€‘person", "Group chat", "Memes only"] },
      { q: "Morning or night person?", options: ["Early bird", "Night owl", "Depends"] },
      { q: "What type of clubs are you into?", options: ["Cultural", "Service", "Arts & media", "STEM", "Career-Oriented"] },
      { q: "What's your favorite place to study?", options: ["Library", "Dorm", "Dining Hall", "Outdoors"] },
      { q: "What's your personality type?", options: ["Introvert", "Ambivert", "Extravert"] },
      { q: "How spontaneous are you?", options: ["Very", "Somewhat", "Little", "Not at all"] },
      { q: "Favorite BC tradition?", options: ["Mudstock/Modstock", "Beanpot", "Marmon", "Red Bandana Game", "Other"] },
      { q: "How do you unwind?", options: ["Music", "Movies", "Reading", "Gym", "Arts & Crafts"] },
      { q: "How big is your ideal friend group?", options: ["1â€‘2 close friends", "Small group", "The more the merrier"] },
      { q: "How important is having the same political views?", options: ["Very important", "A little important", "Doesnâ€™t matter"] },
      { q: "How would you label your political views?", options: ["Very left-leaning", "Liberal", "Moderate", "Conservative", "Very right-leaning"]},
      { q: "Would you like your friend match to be the same gender as you?", options: ["Yes", "Doesn't matter", "No"]},
      { q: "What is your gender identity?", options: ["Woman", "Man", "Nonbinary", "Other"]}
    ];

    function App() {
      const [stage, setStage] = useState("welcome");
      const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
      const [answers, setAnswers] = useState([]);
      const [formData, setFormData] = useState({ firstName: "", lastName: "", email: "" });
      const [isSubmitting, setIsSubmitting] = useState(false);

      const startQuiz = () => setStage("questions");

      const handleAnswer = (option) => {
        const newAnswer = { question: QUESTIONS[currentQuestionIndex].q, answer: option };
        setAnswers([...answers, newAnswer]);
        if (currentQuestionIndex < QUESTIONS.length - 1) {
          setCurrentQuestionIndex(currentQuestionIndex + 1);
        } else {
          setStage("info");
        }
      };

      const handleFormSubmit = async (e) => {
        e.preventDefault();
        if (isSubmitting) return;
        setIsSubmitting(true);

        const dataToSave = {
          firstName: formData.firstName,
          lastName: formData.lastName,
          email: formData.email,
        };

        answers.forEach((item, index) => {
          dataToSave[`Q${index + 1}`] = item.answer;
        });

        try {
          const response = await fetch("https://api.sheetbest.com/sheets/f58c1591-d268-4976-ad57-e753683d99eb", {
            method: "POST",
            mode: "cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataToSave),
          });

          if (response.ok) {
            setStage("success");
          } else {
            alert("Something went wrong. Please try again.");
            setIsSubmitting(false);
          }
        } catch (error) {
          console.error("Error!", error);
          alert("Connection error.");
          setIsSubmitting(false);
        }
      };

      return (
        <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center">
          <AnimatePresence mode="wait">
            {stage === "welcome" && (
              <motion.div key="welcome" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                <h1 className="text-5xl font-extrabold mb-6 text-maroon-700">Friendship Pact</h1>
                <button onClick={startQuiz} className="px-10 py-4 bg-yellow-500 text-white font-bold rounded-full shadow-lg hover:bg-yellow-600 transition-all">
                  Begin
                </button>
              </motion.div>
            )}

            {stage === "questions" && (
              <motion.div 
                key={`question-${currentQuestionIndex}`}
                initial={{ opacity: 0, x: 20 }} 
                animate={{ opacity: 1, x: 0 }} 
                exit={{ opacity: 0, x: -20 }}
                transition={{ duration: 0.4 }}
                className="w-full max-w-md"
              >
                <span className="text-sm font-semibold text-gray-400">
                  Question {currentQuestionIndex + 1} of {QUESTIONS.length}
                </span>
                <h2 className="text-2xl font-bold mt-2 mb-8">{QUESTIONS[currentQuestionIndex].q}</h2>
                <div className="flex flex-col gap-3">
                  {QUESTIONS[currentQuestionIndex].options.map((option) => (
                    <button 
                      key={option} 
                      onClick={() => handleAnswer(option)} 
                      className="px-6 py-3 border-2 border-gray-200 rounded-xl hover:border-yellow-500 hover:bg-yellow-50 transition-all text-left"
                    >
                      {option}
                    </button>
                  ))}
                </div>
              </motion.div>
            )}

            {stage === "info" && (
              <motion.div 
                key="info-screen"
                initial={{ opacity: 0, y: 20 }} 
                animate={{ opacity: 1, y: 0 }} 
                exit={{ opacity: 0 }}
                transition={{ duration: 0.5 }}
                className="w-full max-w-sm"
              >
                <h2 className="text-3xl font-bold mb-8 text-maroon-700">Almost there!</h2>
                <form onSubmit={handleFormSubmit} className="flex flex-col gap-4 text-left">
                  <input required placeholder="First Name" className="w-full p-3 bg-white border rounded-lg" onChange={(e) => setFormData({...formData, firstName: e.target.value})} />
                  <input required placeholder="Last Name" className="w-full p-3 bg-white border rounded-lg" onChange={(e) => setFormData({...formData, lastName: e.target.value})} />
                  <input required type="email" placeholder="BC Email" className="w-full p-3 bg-white border rounded-lg" onChange={(e) => setFormData({...formData, email: e.target.value})} />
                  <button 
                    type="submit" 
                    disabled={isSubmitting}
                    className={`mt-4 py-4 rounded-xl font-bold transition shadow-md ${isSubmitting ? 'bg-gray-400 cursor-not-allowed' : 'bg-black text-white hover:bg-gray-800'}`}
                  >
                    {isSubmitting ? "Submitting..." : "Submit Pact"}
                  </button>
                </form>
              </motion.div>
            )}

            {stage === "success" && (
              <motion.div key="success" initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }}>
                <div className="text-6xl mb-4">ðŸ¦…</div>
                <h2 className="text-3xl font-bold mb-4">Thank you!</h2>
                <p>Stay alert for updates in your email!</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>